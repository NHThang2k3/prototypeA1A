// path: src/pages/packing-list-management/data.ts

import type { PurchaseOrderSummary } from "./types";

export const mockPurchaseOrders: PurchaseOrderSummary[] = [
  {
    id: '1',
    poNumber: 'PO-2023-00123',
    supplier: 'Vải Sợi Miền Nam',
    eta: '2023-11-15',
    status: 'READY_TO_PRINT',
    itemCount: 150, // 100 cuộn vải, 50 thùng phụ liệu
  },
  {
    id: '2',
    poNumber: 'PO-2023-00124',
    supplier: 'Phụ Liệu May Mặc An Phước',
    eta: '2023-11-18',
    status: 'PRINT_COMPLETED',
    itemCount: null,
  },
  {
    id: '3',
    poNumber: 'PO-2023-00125',
    supplier: 'Dệt May Thành Công',
    eta: '2023-11-20',
    status: 'PRINT_COMPLETED',
    itemCount: 85,
  },
    {
    id: '4',
    poNumber: 'PO-2023-00126',
    supplier: 'Vải Sợi Thế Kỷ',
    eta: '2023-11-22',
    status: 'PRINT_COMPLETED',
    itemCount: null,
  },
  {
    id: '5',
    poNumber: 'PO-2023-00127',
    supplier: 'Công ty TNHH Sợi An An',
    eta: '2023-11-25',
    status: 'READY_TO_PRINT',
    itemCount: 210,
  },
];

// src/pages/packing-list-management/PackingListManagementPage.tsx

import React, { useState, useEffect } from "react";
import PageHeader from "./components/PageHeader";
import PackingListFilters from "./components/PackingListFilters";
import PackingListTable from "./components/PackingListTable";
import TableSkeleton from "./components/skeletons/TableSkeleton";
import { mockPurchaseOrders } from "./data";
import type { PurchaseOrderSummary } from "./types";

const PackingListManagementPage = () => {
  const [loading, setLoading] = useState(true);
  const [purchaseOrders, setPurchaseOrders] = useState<PurchaseOrderSummary[]>(
    []
  );

  useEffect(() => {
    const timer = setTimeout(() => {
      setPurchaseOrders(mockPurchaseOrders);
      setLoading(false);
    }, 1000);

    return () => clearTimeout(timer);
  }, []);

  return (
    <div className="p-4 md:p-6 lg:p-8 bg-gray-50 min-h-full">
      <PageHeader />
      <PackingListFilters />

      {loading ? (
        <TableSkeleton />
      ) : (
        // BỎ prop onImportClick
        <PackingListTable purchaseOrders={purchaseOrders} />
      )}
    </div>
  );
};

export default PackingListManagementPage;


// src/pages/packing-list-management/types.ts

// Định nghĩa các trạng thái của một PO trong quy trình này
export type POStatus = 'PENDING_PACKING_LIST' | 'READY_TO_PRINT' | 'PRINT_COMPLETED';

// Dữ liệu tóm tắt của một Purchase Order hiển thị trên bảng
export interface PurchaseOrderSummary {
  id: string;
  poNumber: string;
  supplier: string;
  eta: string; // Expected Time of Arrival
  status: POStatus;
  itemCount: number | null; // Số lượng mục hàng sau khi import, có thể là null ban đầu
}

// src/pages/packing-list-management/components/StatusBadge.tsx

import React from "react";
import type { POStatus } from "../types";
import { CheckCircle, Clock, FileUp } from "lucide-react";

interface StatusBadgeProps {
  status: POStatus;
}

const statusConfig = {
  PENDING_PACKING_LIST: {
    label: "Chưa có Packing List",
    bgColor: "bg-yellow-100",
    textColor: "text-yellow-800",
    icon: <FileUp className="w-4 h-4" />,
  },
  READY_TO_PRINT: {
    label: "Sẵn sàng in QR",
    bgColor: "bg-blue-100",
    textColor: "text-blue-800",
    icon: <Clock className="w-4 h-4" />,
  },
  PRINT_COMPLETED: {
    label: "Đã hoàn tất in",
    bgColor: "bg-green-100",
    textColor: "text-green-800",
    icon: <CheckCircle className="w-4 h-4" />,
  },
};

const StatusBadge: React.FC<StatusBadgeProps> = ({ status }) => {
  const config = statusConfig[status];

  if (!config) {
    return null;
  }

  return (
    <span
      className={`inline-flex items-center gap-x-1.5 py-1 px-2.5 rounded-full text-xs font-medium ${config.bgColor} ${config.textColor}`}
    >
      {config.icon}
      {config.label}
    </span>
  );
};

export default StatusBadge;

// src/pages/packing-list-management/components/PageHeader.tsx

const PageHeader = () => {
  return (
    <div className="flex justify-between items-center mb-6">
      <div>
        <h1 className="text-3xl font-bold text-gray-800">
          Quản lý Packing List & In QR Code
        </h1>
        <p className="text-gray-500 mt-1">
          Nhập thông tin lô hàng và tạo mã QR để theo dõi.
        </p>
      </div>
    </div>
  );
};

export default PageHeader;


// src/pages/packing-list-management/components/PackingListTable.tsx

import React from "react";
import { useNavigate } from "react-router-dom";
import type { PurchaseOrderSummary } from "../types";
import StatusBadge from "./StatusBadge";
import { Button } from "../../../components/ui/button";
import { QrCode, Eye } from "lucide-react"; // Bỏ UploadCloud

// Bỏ prop onImportClick
interface PackingListTableProps {
  purchaseOrders: PurchaseOrderSummary[];
}

const PackingListTable: React.FC<PackingListTableProps> = ({
  purchaseOrders,
}) => {
  const navigate = useNavigate();

  // THAY ĐỔI LOGIC CỦA HÀM NÀY
  const getActionButton = (po: PurchaseOrderSummary) => {
    // Tất cả các hành động đều điều hướng đến trang chi tiết
    const actionHandler = () => navigate(`/shipments/${po.poNumber}`);

    switch (po.status) {
      case "READY_TO_PRINT":
        return (
          <Button size="sm" onClick={actionHandler}>
            <QrCode className="w-4 h-4 mr-2" />
            Xem & In QR
          </Button>
        );
      // Gộp 2 trường hợp này vì chúng có cùng hành động
      case "PENDING_PACKING_LIST":
      case "PRINT_COMPLETED":
        return (
          <Button variant="secondary" size="sm" onClick={actionHandler}>
            <Eye className="w-4 h-4 mr-2" />
            Xem chi tiết
          </Button>
        );
      default:
        return null;
    }
  };

  return (
    <div className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
      <div className="overflow-x-auto">
        <table className="min-w-full divide-y divide-gray-200">
          <thead className="bg-gray-50">
            {/* Thead không thay đổi */}
            <tr>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Mã PO
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Nhà cung cấp
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Ngày dự kiến đến
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Số lượng mục
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Trạng thái
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Hành động
              </th>
            </tr>
          </thead>
          <tbody className="bg-white divide-y divide-gray-200">
            {purchaseOrders.map((po) => (
              <tr key={po.id} className="hover:bg-gray-50">
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                  {po.poNumber}
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  {po.supplier}
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  {po.eta}
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  {po.itemCount ?? "N/A"}
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm">
                  <StatusBadge status={po.status} />
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-center">
                  {/* Hàm này đã được cập nhật */}
                  {getActionButton(po)}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default PackingListTable;


// src/pages/packing-list-management/components/PackingListFilters.tsx

import { Input } from "../../../components/ui/input"; // Giả sử bạn có component Input
import { Button } from "../../../components/ui/button";
import { Search, Filter } from "lucide-react";

const PackingListFilters = () => {
  return (
    <div className="mb-4 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
      <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <div className="lg:col-span-2">
          <label
            htmlFor="po-search"
            className="block text-sm font-medium text-gray-700 mb-1"
          >
            Tìm kiếm PO
          </label>
          <div className="relative">
            <Input
              id="po-search"
              placeholder="Nhập mã PO, nhà cung cấp..."
              className="pl-10"
            />
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          </div>
        </div>
        <div>
          <label
            htmlFor="status-filter"
            className="block text-sm font-medium text-gray-700 mb-1"
          >
            Trạng thái
          </label>
          <select
            id="status-filter"
            className="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
          >
            <option value="">Tất cả trạng thái</option>
            <option value="PENDING_PACKING_LIST">Chưa có Packing List</option>
            <option value="READY_TO_PRINT">Sẵn sàng in QR</option>
            <option value="PRINT_COMPLETED">Đã hoàn tất in</option>
          </select>
        </div>
        <div className="self-end">
          <Button className="w-full">
            <Filter className="w-4 h-4 mr-2" />
            Lọc
          </Button>
        </div>
      </div>
    </div>
  );
};

export default PackingListFilters;

// src/pages/packing-list-management/components/skeletons/TableSkeleton.tsx

const TableSkeleton = () => {
  const SkeletonRow = () => (
    <tr className="animate-pulse">
      <td className="px-6 py-4">
        <div className="h-4 bg-gray-200 rounded w-3/4"></div>
      </td>
      <td className="px-6 py-4">
        <div className="h-4 bg-gray-200 rounded w-full"></div>
      </td>
      <td className="px-6 py-4">
        <div className="h-4 bg-gray-200 rounded w-1/2"></div>
      </td>
      <td className="px-6 py-4">
        <div className="h-4 bg-gray-200 rounded w-1/4"></div>
      </td>
      <td className="px-6 py-4">
        <div className="h-6 bg-gray-200 rounded-full w-32"></div>
      </td>
      <td className="px-6 py-4 text-center">
        <div className="h-8 bg-gray-200 rounded w-28 mx-auto"></div>
      </td>
    </tr>
  );

  return (
    <div className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
      <div className="overflow-x-auto">
        <table className="min-w-full divide-y divide-gray-200">
          <thead className="bg-gray-50">
            {/* ... copy thead from PackingListTable ... */}
            <tr>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Mã PO
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Nhà cung cấp
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Ngày dự kiến đến
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Số lượng mục
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Trạng thái
              </th>
              <th
                scope="col"
                className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Hành động
              </th>
            </tr>
          </thead>
          <tbody className="bg-white divide-y divide-gray-200">
            {Array.from({ length: 5 }).map((_, i) => (
              <SkeletonRow key={i} />
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default TableSkeleton;
